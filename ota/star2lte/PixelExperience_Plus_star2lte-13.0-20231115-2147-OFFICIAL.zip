
project lineage-sdk/
diff --git a/Android.bp b/Android.bp
index 9a35f3bb..34204977 100644
--- a/Android.bp
+++ b/Android.bp
@@ -66,11 +66,9 @@ lineage_sdk_internal_src = "sdk/src/java/org/lineageos/internal"
 library_src = "lineage/lib/main/java"
 
 lineage_sdk_LOCAL_STATIC_JAVA_LIBRARIES = [
-    "vendor.lineage.health-V1-java",
     "vendor.lineage.livedisplay-V2.0-java",
     "vendor.lineage.livedisplay-V2.1-java",
     "vendor.lineage.touch-V1.0-java",
-    "vendor.lineage.trust-V1.0-java",
 ]
 
 // READ ME: ########################################################

project manifest/
diff --git a/default.xml b/default.xml
index e7d7677..b742c47 100644
--- a/default.xml
+++ b/default.xml
@@ -11,13 +11,13 @@
   <remote name="gitlab"
           fetch="https://gitlab.com" />
 
-  <default revision="refs/tags/android-13.0.0_r75"
+  <default revision="refs/tags/android-13.0.0_r83"
            remote="aosp"
            sync-j="4"
            sync-c="true"
            sync-f="true" />
 
-  <superproject name="platform/superproject" remote="aosp" revision="android-13.0.0_r75"/>
+  <superproject name="platform/superproject" remote="aosp" revision="android-13.0.0_r83"/>
   <contactinfo bugurl="go/repo-bug" />
   <!-- BEGIN open-source projects -->
   <project path="build/make" name="platform/build" groups="pdk" >
@@ -936,7 +936,7 @@
   <project path="packages/apps/Contacts" name="platform/packages/apps/Contacts" groups="pdk-fs" />
   <project path="packages/apps/DeskClock" name="platform/packages/apps/DeskClock" groups="pdk-fs" />
   <project path="packages/apps/DevCamera" name="platform/packages/apps/DevCamera" groups="pdk" />
-  <project path="packages/apps/Dialer" name="platform/packages/apps/Dialer" groups="pdk-fs" />
+  <project path="packages/apps/Dialer" name="LineageOS/android_packages_apps_Dialer" groups="pdk-fs" remote="github" revision="lineage-20.0" />
   <project path="packages/apps/DocumentsUI" name="platform/packages/apps/DocumentsUI" groups="pdk-cw-fs,pdk-fs" />
   <project path="packages/apps/EmergencyInfo" name="platform/packages/apps/EmergencyInfo" groups="pdk-fs" />
   <project path="packages/apps/Gallery" name="platform/packages/apps/Gallery" groups="pdk-fs" />
diff --git a/snippets/pixel.xml b/snippets/pixel.xml
index c021586..2386bda 100644
--- a/snippets/pixel.xml
+++ b/snippets/pixel.xml
@@ -1,6 +1,11 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <manifest>
 
+  <remote name="lineageos"
+          fetch="https://github.com/"
+          revision="lineage-20.0"
+          review="review.lineageos.org" />
+
   <remote name="pixel"
           fetch="https://github.com/PixelExperience"
           revision="thirteen"
@@ -110,6 +115,7 @@
   <project path="hardware/st/nfc" name="hardware_st_nfc" remote="pixel" />
 
   <!-- Packages repos -->
+  <project path="lineage-sdk" name="LineageOS/android_lineage-sdk" remote="lineageos" />
   <project path="packages/apps/Camera2" name="packages_apps_Camera2" remote="pixel" />
   <project path="packages/apps/CarrierConfig" name="packages_apps_CarrierConfig" remote="pixel" />
   <project path="packages/apps/Nfc" name="packages_apps_Nfc" remote="pixel" />
diff --git a/snippets/remove.xml b/snippets/remove.xml
index df0a80e..6237344 100644
--- a/snippets/remove.xml
+++ b/snippets/remove.xml
@@ -158,12 +158,10 @@
   <remove-project name="platform/packages/apps/Contacts" />
   <remove-project name="platform/packages/apps/DevCamera" />
   <remove-project name="platform/packages/apps/DeskClock" />
-  <remove-project name="platform/packages/apps/Dialer" />
   <remove-project name="platform/packages/apps/Gallery" />
   <remove-project name="platform/packages/apps/Gallery2" />
   <remove-project name="platform/packages/apps/LegacyCamera" />
   <remove-project name="platform/packages/apps/Messaging" />
-  <remove-project name="platform/packages/apps/Music" />
   <remove-project name="platform/packages/apps/Nfc" />
   <remove-project name="platform/packages/apps/PhoneCommon" />
   <remove-project name="platform/packages/apps/Protips" />

project packages/apps/Dialer/
diff --git a/java/com/android/dialer/app/res/values/cm_strings.xml b/java/com/android/dialer/app/res/values/cm_strings.xml
index 79dee54d6..b4b92189a 100644
--- a/java/com/android/dialer/app/res/values/cm_strings.xml
+++ b/java/com/android/dialer/app/res/values/cm_strings.xml
@@ -38,6 +38,8 @@
     <string name="call_recording_format">Audio format</string>
     <string name="wb_amr_format" translatable="false">AMR-WB</string>
     <string name="aac_format" translatable="false">AAC</string>
+    <string name="auto_call_recording_title">Auto call recording</string>
+    <string name="auto_call_recording_key" translatable="false">auto_call_recording</string>
 
     <string name="call_via">Call via</string>
     <string name="call_via_dialog_title">Call via\u2026</string>
diff --git a/java/com/android/dialer/app/res/xml/sound_settings.xml b/java/com/android/dialer/app/res/xml/sound_settings.xml
index aa025874f..858fd0534 100644
--- a/java/com/android/dialer/app/res/xml/sound_settings.xml
+++ b/java/com/android/dialer/app/res/xml/sound_settings.xml
@@ -75,6 +75,11 @@
     android:key="@string/call_recording_category_key"
     android:title="@string/call_recording_category_title">
 
+    <SwitchPreference
+      android:defaultValue="false"
+      android:key="@string/auto_call_recording_key"
+      android:title="@string/auto_call_recording_title"/>    
+
     <ListPreference
       android:key="@string/call_recording_format_key"
       android:title="@string/call_recording_format"
diff --git a/java/com/android/dialer/callrecord/res/values/config.xml b/java/com/android/dialer/callrecord/res/values/config.xml
index 7aabd6cac..2832c87bc 100644
--- a/java/com/android/dialer/callrecord/res/values/config.xml
+++ b/java/com/android/dialer/callrecord/res/values/config.xml
@@ -16,8 +16,8 @@
 -->
 
 <resources>
-    <bool name="call_recording_enabled">false</bool>
+    <bool name="call_recording_enabled">true</bool>
     <!-- 1 (MIC) for microphone audio source (default)
          4 (VOICE_CALL) if supported by device for voice call uplink + downlink audio source -->
-    <integer name="call_recording_audio_source">1</integer>
+    <integer name="call_recording_audio_source">4</integer>
 </resources>
diff --git a/java/com/android/incallui/CallButtonPresenter.java b/java/com/android/incallui/CallButtonPresenter.java
index 8fba90be7..a8882f2dd 100644
--- a/java/com/android/incallui/CallButtonPresenter.java
+++ b/java/com/android/incallui/CallButtonPresenter.java
@@ -22,6 +22,7 @@ import android.content.SharedPreferences;
 import android.content.pm.PackageManager;
 import android.os.Bundle;
 import android.os.Trace;
+import android.os.Handler;
 import android.preference.PreferenceManager;
 import android.support.v4.app.Fragment;
 import android.support.v4.os.UserManagerCompat;
@@ -72,6 +73,7 @@ public class CallButtonPresenter
   private DialerCall call;
   private boolean isInCallButtonUiReady;
   private PhoneAccountHandle otherAccount;
+  private boolean isRecording = false;
 
   private CallRecorder.RecordingProgressListener recordingProgressListener =
       new CallRecorder.RecordingProgressListener() {
@@ -113,6 +115,12 @@ public class CallButtonPresenter
     CallRecorder recorder = CallRecorder.getInstance();
     recorder.addRecordingProgressListener(recordingProgressListener);
 
+    if(recorder.isRecording()){
+      inCallButtonUi.setCallRecordingState(true);
+    } else {
+      inCallButtonUi.setCallRecordingState(false);
+    } 
+
     // Update the buttons state immediately for the current call
     onStateChange(InCallState.NO_CALLS, inCallPresenter.getInCallState(), CallList.getInstance());
     isInCallButtonUiReady = true;
@@ -142,14 +150,24 @@ public class CallButtonPresenter
   @Override
   public void onStateChange(InCallState oldState, InCallState newState, CallList callList) {
     Trace.beginSection("CallButtonPresenter.onStateChange");
-    if (call != null) {
-      call.removeListener(this);
-    }
+    CallRecorder recorder = CallRecorder.getInstance();
+    boolean isEnabled = PreferenceManager.getDefaultSharedPreferences(context).getBoolean(context.getString(R.string.auto_call_recording_key), false);
+
     if (newState == InCallState.OUTGOING) {
       call = callList.getOutgoingCall();
     } else if (newState == InCallState.INCALL) {
       call = callList.getActiveOrBackgroundCall();
 
+      if (!isRecording && isEnabled && call != null) {
+        isRecording = true;
+        new Handler().postDelayed(new Runnable() {
+            @Override
+            public void run() {
+                callRecordClicked(true);
+            }
+        }, 500);
+      }
+
       // When connected to voice mail, automatically shows the dialpad.
       // (On previous releases we showed it when in-call shows up, before waiting for
       // OUTGOING.  We may want to do that once we start showing "Voice mail" label on
@@ -165,6 +183,9 @@ public class CallButtonPresenter
       }
       call = callList.getIncomingCall();
     } else {
+      if (isEnabled && recorder.isRecording()) {
+        recorder.finishRecording();
+      }
       call = null;
     }
 
@@ -297,23 +318,9 @@ public class CallButtonPresenter
   public void callRecordClicked(boolean checked) {
     CallRecorder recorder = CallRecorder.getInstance();
     if (checked) {
-      final SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(context);
-      boolean warningPresented = prefs.getBoolean(KEY_RECORDING_WARNING_PRESENTED, false);
-      if (!warningPresented) {
-        new AlertDialog.Builder(getActivity())
-            .setTitle(R.string.recording_warning_title)
-            .setMessage(R.string.recording_warning_text)
-            .setPositiveButton(R.string.onscreenCallRecordText, (dialog, which) -> {
-              prefs.edit()
-                  .putBoolean(KEY_RECORDING_WARNING_PRESENTED, true)
-                  .apply();
-              startCallRecordingOrAskForPermission();
-            })
-            .setNegativeButton(android.R.string.cancel, null)
-            .show();
-      } else {
+       if(!recorder.isRecording()) {
         startCallRecordingOrAskForPermission();
-      }
+       }
     } else {
       if (recorder.isRecording()) {
         recorder.finishRecording();

project packages/apps/Updates/
diff --git a/app/src/main/java/org/pixelexperience/ota/misc/Constants.java b/app/src/main/java/org/pixelexperience/ota/misc/Constants.java
index 9c05054e..6d63c708 100644
--- a/app/src/main/java/org/pixelexperience/ota/misc/Constants.java
+++ b/app/src/main/java/org/pixelexperience/ota/misc/Constants.java
@@ -30,9 +30,9 @@ public final class Constants {
     static final String PROP_AB_DEVICE = "ro.build.ab_update";
     static final String PROP_DEVICE = "org.pixelexperience.device";
     static final String PROP_BUILD_VERSION = "org.pixelexperience.version";
-    static final String OTA_URL = "https://api.pixelexperience.org/ota/%s/%s";
-    static final String OTA_CI_URL = "https://api.pixelexperience.org/ota_ci/%s/%s";
-    static final String MAINTAINER_URL = "https://download.pixelexperience.org/team/%s";
-    static final String DOWNLOAD_WEBPAGE_URL = "https://download.pixelexperience.org/changelog/%s/%s";
+    static final String OTA_URL = "https://raw.githubusercontent.com/Joshua-Gr/PixelExperienceOTA/main/ota/%s/%s";
+    static final String OTA_CI_URL = "https://raw.githubusercontent.com/Joshua-Gr/PixelExperienceOTA/main/ota_ci/%s/%s";
+    static final String MAINTAINER_URL = "https://github.com/%s";
+    static final String DOWNLOAD_WEBPAGE_URL = "https://github.com/Joshua-Gr/PixelExperienceOTA/blob/main/ota/%s/%s";
     static final String EXPORT_PATH = "PixelExperience-Updates/";
 }
